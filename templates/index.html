<!DOCTYPE html>
<html lang="en">
  <head>
    <title>NorthStar Goods</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="{{ url_for('static', filename='style/style.css') }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

  </head>
  <body>
    <!-- Navbar -->
    <div class="main-navbar">
      <div class="navbar">
        <img src="{{ url_for('static', filename='images/logo-2.png') }}" alt="logo" class="logo" >
        
        <ul class="nav-links">
          <div class="search-bar">
            <form action="">
              <input type="search" name="product-search" id="product-search" placeholder="Search for products">
              <button class="search-btn"><i class="fa fa-search"></i></button>
            </form>
          </div>
          <li class="link"><a href="{{ url_for('login') }}">Sign In</a></li>
          <li class="link"><a href=""><i class="fa fa-shopping-cart cart-icon" aria-hidden="true" style="font-size: 24px;"></i></a></li>
        </ul>
      </div>

      <div class="categories">
        <ul>
          <li style="font-weight: 500;">Black Friday</li>
          <li>Electronics</li>
          <li>Home Appliances</li>
          <li>Clothes</li>
          <li>Sports</li>
          <li>Gaming</li>
          <li>Toys</li>
          <li>Groceries</li>
        </ul>
      </div>
  </div>

  <!-- Special offer grid -->

    <div class="offers">
      <h1 style="color: #F8FAFC;font-size: 45px;">Black Friday Offers</h1>
      <div id="product-list">
      <!-- <div class="product-card">
        <img src="/Product-Images/Apple iPad 10.9 inch.jpg" alt="" style="width: 100%;">

      </div> -->
      </div>
    </div>


    <!-- Code for chatbox -sr -->
    <div id="chat-widget">
      <div class="chat-header">NorthStar Assistant</div>
      <div class="chat-body" id="chat-body">
        <div class="chat-message bot">
          Hi! ðŸ‘‹. Have any questions about the products we sell, go ahead and ask us some questions. 
        </div>
      </div>
      <div class="chat-input-row">
        <input type="text" id="chat-input" placeholder="What is the latest airpod generation?" autocomplete="off"/>
        <button id="chat-send">Send</button>
      </div>
    </div>
    <button id="chat-toggle" aria-label="Open chat">ðŸ’¬</button>

  </body>

  <!-- -----------------------------------------------------------------------------------------  -->
  <!-- -----------------------------------------------------------------------------------------  -->
  <!-- KOWSI THIS IS UR OLD CODE -->
  <!-- <script>
      async function fetchProducts(){
        try{
          const res = await fetch('/api/products');
          if (!res.ok){
            throw new Error(`Response status: ${res.status}`);         
          }
          const productList = await res.json();
          
          const productListDiv = document.getElementById('product-list');
          productList.forEach(product => {
            const productDiv = document.createElement('div');
          
            const img = document.createElement('img');
            const product_name = document.createElement("p")
            product_name.className = 'product-name';
            product_name.innerText = product.name.substring(0,20);
            const price = document.createElement('h3');
            const cartButton = document.createElement("button");
            cartButton.className = 'cart-btn';
            cartButton.innerHTML = 'Add to Cart'

            productDiv.className = 'product';

            img.src = product.image_url;
            img.alt = product.name;
            img.className = 'product-image';
            
            price.innerHTML = `$${product.price}`
            price.className = 'product-price'

            productDiv.appendChild(img);
            productDiv.appendChild(product_name);
            productDiv.appendChild(price);
            productDiv.appendChild(cartButton);
            productListDiv.appendChild(productDiv);

          });



        } catch (error){
          console.error(error.message)
        }
      }
      fetchProducts();
  </script> -->
  <!-- -----------------------------------------------------------------------------------------  -->
  <!-- -----------------------------------------------------------------------------------------  -->

  <script>
  // Fetch products from DummyJSON and render only tech devices
  async function fetchProducts() {
    try {
      // 1) Get ALL products but only the fields we care about
      const res = await fetch(
        "https://dummyjson.com/products?limit=0&select=title,price,thumbnail,category");

      if (!res.ok) {
        throw new Error(`Response status: ${res.status}`);
      }

      // 2) DummyJSON returns: { products: [...], total, skip, limit }
      const data = await res.json();
      let products = data.products || [];

      // 3) Keep only tech-type categories
      const allowedCategories = [
        "smartphones",
        "laptops",
        "tablets",
        "mobile-accessories"
      ];

      products = products.filter((product) =>
        allowedCategories.includes(product.category)
      );

      // 4) Get container
      const productListDiv = document.getElementById("product-list");
      if (!productListDiv) {
        console.error("No element with id 'product-list' found in the DOM.");
        return;
      }

      productListDiv.innerHTML = "";

      if (products.length === 0) {
        productListDiv.innerHTML =
          "<p style='color:white;'>No tech products found.</p>";
        return;
      }

      // 5) Render cards
      products.forEach((product) => {
        const productDiv = document.createElement("div");
        productDiv.className = "product";

        const img = document.createElement("img");
        img.src = product.thumbnail;
        img.alt = product.title;
        img.className = "product-image";

        const title = document.createElement("p");
        title.className = "product-name";
        title.textContent =
          product.title.length > 25
            ? product.title.substring(0, 25) + "..."
            : product.title;

        const price = document.createElement("h3");
        price.className = "product-price";
        price.textContent = `$${product.price}`;

        const category = document.createElement("p");
        category.className = "product-category";
        category.textContent = product.category;

        const cartButton = document.createElement("button");
        cartButton.className = "cart-btn";
        cartButton.textContent = "Add to Cart";

        productDiv.appendChild(img);
        productDiv.appendChild(title);
        productDiv.appendChild(price);
        productDiv.appendChild(category);
        productDiv.appendChild(cartButton);

        productListDiv.appendChild(productDiv);
      });
    } catch (error) {
      console.error("Error fetching products:", error);

      const productListDiv = document.getElementById("product-list");
      if (productListDiv) {
        productListDiv.innerHTML =
          "<p style='color:white;'>Sorry, we couldn't load the products right now.</p>";
      }
    }
  }

  // Run on page load
  fetchProducts();
</script>







 <script>

  // ----- Chat widget logic -----
  const chatWidget = document.getElementById("chat-widget");
  const chatToggle = document.getElementById("chat-toggle");
  const chatBody = document.getElementById("chat-body");
  const chatInput = document.getElementById("chat-input");
  const chatSend = document.getElementById("chat-send");

  function appendMessage(role, text) {
    const msg = document.createElement("div");
    msg.className = "chat-message " + role;
    msg.textContent = text;
    chatBody.appendChild(msg);
    chatBody.scrollTop = chatBody.scrollHeight;
    return msg;
  }

  async function sendChat() {
    const text = (chatInput.value || "").trim();
    if (!text) return;

    appendMessage("user", text);
    chatInput.value = "";

    const thinkingEl = appendMessage("bot", "Thinking...");

    try {
      const resp = await fetch("/ai/ask", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({ prompt: text }),
      });

      if (!resp.ok) {
        thinkingEl.textContent = "Error: " + resp.status;
        return;
      }

      const data = await resp.json();
      thinkingEl.textContent = data.output || "(No response from model.)";
    } catch (err) {
      console.error(err);
      thinkingEl.textContent = "Network error. Please try again.";
    }
  }

  // Toggle open/close when clicking the bubble
  chatToggle.addEventListener("click", () => {
    chatWidget.classList.toggle("open");
  });

  // Send on button click
  chatSend.addEventListener("click", sendChat);

  // Send on Enter key (Shift+Enter = newline ignored since it's a single-line input)
  chatInput.addEventListener("keydown", (e) => {
    if (e.key === "Enter") {
      e.preventDefault();
      sendChat();
    }
  });
</script>
  
</html>