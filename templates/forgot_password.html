<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Forgot Password</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style/forgot.css') }}">
</head>
<body>
  <!-- Top notification bar (same idea as index.html) -->
  <div id="notification" class="notification"></div>

  <section id="forgot-section">
    <div class="forgot-container">
      <h2>Reset your password</h2>

      <div class="inputs">
        <label for="fp-email">Email</label>
        <input type="email" id="fp-email" required>

        <label for="fp-answer">Security Answer</label>
        <input type="text" id="fp-answer" required>

        <label for="fp-new-password">New Password</label>
        <input type="password" id="fp-new-password" required>

        <label for="fp-confirm-password">Confirm New Password</label>
        <input type="password" id="fp-confirm-password" required>
      </div>

      <button class="forgot-btn" onclick="resetPassword()">Reset Password</button>
      <h4><a class="signup-link" href="/login">Back to Login</a></h4>
    </div>
  </section>

  <script>
    // --- same style notification helper as index.html ---
    const notificationEl = document.getElementById("notification");
    let notificationTimeout;

    function showNotification(message, type = "success", duration = 3000) {
      if (!notificationEl) return;

      notificationEl.className = "notification"; // reset
      notificationEl.textContent = message;

      if (type === "success") {
        notificationEl.classList.add("notification-success");
      } else if (type === "error") {
        notificationEl.classList.add("notification-error");
      }

      notificationEl.classList.add("show");

      if (notificationTimeout) {
        clearTimeout(notificationTimeout);
      }
      notificationTimeout = setTimeout(() => {
        notificationEl.classList.remove("show");
      }, duration);
    }

    notificationEl?.addEventListener("click", () => {
      notificationEl.classList.remove("show");
    });

    // --- main reset function ---
    async function resetPassword() {
      const email = document.getElementById("fp-email").value;
      const answer = document.getElementById("fp-answer").value;
      const newPassword = document.getElementById("fp-new-password").value;
      const confirmPassword = document.getElementById("fp-confirm-password").value;

      try {
        const res = await fetch("/auth/forgot-password", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            email: email,
            security_answer: answer,
            new_password: newPassword,
            confirm_password: confirmPassword
          })
        });

        const data = await res.json();

        if (!res.ok) {
          // show backend error
          showNotification(data.error || "Could not reset password.", "error");
          return;
        }

        showNotification(data.message || "Password updated!", "success");
        setTimeout(() => {
          window.location.href = "/login";
        }, 1500);
      } catch (err) {
        console.error(err);
        showNotification("Network error. Please try again.", "error");
      }
    }
  </script>
</body>
</html>
